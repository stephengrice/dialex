<%= link_to 'All ' + @language.name.capitalize + ' Lessons', @language, class: 'btn btn-sm btn-primary' %>

<h1><%= @language.name.capitalize %> Lesson: <%= @lesson.name %></h1>


<div id="widget-learn">
 <form>
  <div class="instructions">Translate the following:</div>
  <div class="prompt">
    <span>Original</span>
  </div>
  <div class="user-input">
    <input type="text">
  </div>
  <div class="bottom">
    <div id="exercise-feedback"></div>
    <button class="btn btn-primary" type="submit">Check</button>
  </div>
  </form>
  <div class="complete">
    <h2>Lesson Complete</h2>
  </div>
</div>

<script>
var exercises = <%= @exercises.to_json.html_safe %>;
var currentExercise = 0;
// Is the widget 'waiting' for user to submit?
var waiting = true;
fillWidget(exercises[currentExercise]);

function fillWidget() {
  exercise = exercises[currentExercise];
  widget = $('#widget-learn');
  widget.find('.prompt').html(exercise.original);
  waiting = true;
}
function grade() {
  userInput = $('#widget-learn .user-input').children().first().val();
  if (userInput.toLowerCase() == exercises[currentExercise].translation.toLowerCase()) {
    waiting = false;
    // Display success
    $('#exercise-feedback').html("Success");
  } else {
    waiting = true;
    // Display failure
    $('#exercise-feedback').html("Try again");
  }
}
function nextExercise() {
  currentExercise++;
  // Check if we have any exercises left
  if (currentExercise < exercises.length) {
      $('#exercise-feedback').html('');
    $('#widget-learn .user-input').children().first().val('');
    fillWidget();
  } else {
    $('#widget-learn form').hide();
    $('#widget-learn .complete').show();
  }
}
$('#widget-learn form').submit(function(e) {
  e.preventDefault();
  if ($('#widget-learn .user-input').children().first().val().length < 1) {
    return;
  }
  
  console.log("submitted");
  if (waiting) {
    grade();
  } else {
    nextExercise();
  }
});
</script>